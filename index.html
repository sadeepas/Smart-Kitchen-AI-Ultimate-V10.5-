<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Smart Kitchen AI | V10.5 Ultimate Edition</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üç≤</text></svg>">
    <meta name="theme-color" content="#059669">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description"
        content="The ultimate kitchen management system with OCR, Analytics, AI Recipe generation, and Cook Mode.">
    <link rel="manifest" href="manifest.json">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style type="text/css">
        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 300;
            src: url(/cf-fonts/v/outfit/5.0.11/latin/wght/normal.woff2);
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 300;
            src: url(/cf-fonts/v/outfit/5.0.11/latin-ext/wght/normal.woff2);
            unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 400;
            src: url(/cf-fonts/v/outfit/5.0.11/latin-ext/wght/normal.woff2);
            unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 400;
            src: url(/cf-fonts/v/outfit/5.0.11/latin/wght/normal.woff2);
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 500;
            src: url(/cf-fonts/v/outfit/5.0.11/latin/wght/normal.woff2);
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 500;
            src: url(/cf-fonts/v/outfit/5.0.11/latin-ext/wght/normal.woff2);
            unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 600;
            src: url(/cf-fonts/v/outfit/5.0.11/latin-ext/wght/normal.woff2);
            unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 600;
            src: url(/cf-fonts/v/outfit/5.0.11/latin/wght/normal.woff2);
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 700;
            src: url(/cf-fonts/v/outfit/5.0.11/latin/wght/normal.woff2);
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            font-display: swap;
        }

        @font-face {
            font-family: Outfit;
            font-style: normal;
            font-weight: 700;
            src: url(/cf-fonts/v/outfit/5.0.11/latin-ext/wght/normal.woff2);
            unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 400;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/sinhala/wght/normal.woff2);
            unicode-range: U+0964-0965, U+0D81-0DF4, U+200C-200D, U+25CC, U+111E1-111F4;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 400;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/latin/wght/normal.woff2);
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 400;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/latin-ext/wght/normal.woff2);
            unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 500;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/latin/wght/normal.woff2);
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 500;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/latin-ext/wght/normal.woff2);
            unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 500;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/sinhala/wght/normal.woff2);
            unicode-range: U+0964-0965, U+0D81-0DF4, U+200C-200D, U+25CC, U+111E1-111F4;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 700;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/latin/wght/normal.woff2);
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 700;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/latin-ext/wght/normal.woff2);
            unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
            font-display: swap;
        }

        @font-face {
            font-family: Noto Sans Sinhala;
            font-style: normal;
            font-weight: 700;
            src: url(/cf-fonts/v/noto-sans-sinhala/5.0.11/sinhala/wght/normal.woff2);
            unicode-range: U+0964-0965, U+0D81-0DF4, U+200C-200D, U+25CC, U+111E1-111F4;
            font-display: swap;
        }
    </style>
    <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

    <script>
        // --- APP CONFIGURATION LOADER ---
        (function () {
            try {
                const config = JSON.parse(localStorage.getItem('app_config'));

                // 1. Tailwind Theme Config
                const primaryColor = config?.themeColor || '#10b981';
                const isDark = config?.forceDark || false;

                window.tailwind = {
                    darkMode: 'class',
                    config: {
                        theme: {
                            extend: {
                                fontFamily: { sans: ['Outfit', 'sans-serif'], sinhala: ['Noto Sans Sinhala', 'sans-serif'] },
                                colors: {
                                    primary: {
                                        50: '#ecfdf5', 100: '#d1fae5', 200: '#a7f3d0',
                                        500: primaryColor,
                                        600: primaryColor, // Main
                                        700: primaryColor,
                                        900: '#064e3b'
                                    },
                                    accent: { 400: '#fbbf24', 500: '#f59e0b', 600: '#d97706' },
                                    darkbg: '#0f172a', surface: '#1e293b',
                                    warm: '#fcfaf9'
                                },
                                animation: {
                                    'slide-up': 'slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1)',
                                    'fade-in': 'fadeIn 0.3s ease-out'
                                },
                                keyframes: {
                                    slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                                    fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }
                                }
                            }
                        }
                    }
                };

                // 2. Metadata (Title & Favicon)
                if (config) {
                    if (config.appName) document.title = config.appName + ' | ' + (config.appVersion || '');
                    if (config.appLogo) {
                        let link = document.querySelector("link[rel~='icon']");
                        if (!link) {
                            link = document.createElement('link');
                            link.rel = 'icon';
                            document.head.appendChild(link);
                        }
                        if (config.appLogo.startsWith('http') || config.appLogo.startsWith('data:')) {
                            link.href = config.appLogo;
                        } else {
                            link.href = `data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>${config.appLogo}</text></svg>`;
                        }
                    }
                    if (isDark) document.documentElement.classList.add('dark');
                }

            } catch (e) { console.error("Config Init Error", e); }
        })();
    </script>

    <!-- Link CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- AI Brain -->
    <script src="ai_engine.js"></script>
    <!-- Link JS -->
    <!-- Link JS -->
    <script defer src="recipes.js"></script>
    <script defer src="script.js"></script>


</head>

<body
    class="bg-gray-50 text-slate-800 dark:bg-darkbg dark:text-slate-100 font-sans transition-colors duration-300 flex flex-col h-full selection:bg-primary-500 selection:text-white"
    onload="applyLoaderConfig()">

    <script>
        function applyLoaderConfig() {
            try {
                const config = JSON.parse(localStorage.getItem('app_config'));
                if (config && config.showLoader === false) {
                    const loader = document.getElementById('loader');
                    if (loader) loader.style.display = 'none';
                }
            } catch (e) { }
        }
    </script>

    <div id="loader"
        class="fixed inset-0 z-[100] bg-primary-600 flex flex-col items-center justify-center text-white transition-opacity duration-500">
        <div class="relative mb-4">
            <i class="fa-solid fa-robot text-6xl animate-bounce"></i>
            <div class="absolute -bottom-2 w-full h-2 bg-black/20 rounded-full blur-sm"></div>
        </div>
        <h1 class="text-3xl font-bold mt-4 tracking-tight">Kitchen AI <span
                class="text-xs align-top bg-white text-primary-600 px-1 rounded">ULTIMATE V10.5</span></h1>
        <p class="opacity-75 text-sm mb-8 mt-2">Initializing System Resources...</p>

        <button id="loader-reset-btn" onclick="localStorage.clear(); location.reload();"
            class="bg-white text-red-600 px-6 py-3 rounded-xl font-bold shadow-xl hover:bg-gray-100 transition">
            <i class="fa-solid fa-triangle-exclamation mr-2"></i> Factory Reset
        </button>
        <p id="loader-hint" class="absolute bottom-10 text-xs opacity-50 hidden">System unresponsive? Use Reset.</p>
    </div>

    <div class="flex flex-1 h-full overflow-hidden relative">

        <aside
            class="hidden md:flex flex-col w-72 bg-white dark:bg-surface border-r dark:border-gray-800 z-30 shadow-xl">
            <div class="p-6 border-b dark:border-gray-800 flex items-center gap-3 text-primary-600">
                <div class="w-10 h-10 rounded-xl bg-primary-100 flex items-center justify-center shadow-inner"><i
                        class="fa-solid fa-robot text-xl"></i></div>
                <div>
                    <h1 class="font-bold text-xl leading-none">KitchenAI</h1>
                    <p class="text-[10px] uppercase text-gray-400 font-bold tracking-wider">Ultimate V10.5</p>
                </div>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto custom-scroll" id="desktop-menu"></nav>
        </aside>

        <main class="flex-1 flex flex-col relative w-full h-full overflow-hidden bg-gray-50 dark:bg-darkbg">

            <header class="md:hidden glass h-16 shrink-0 z-20 flex items-center justify-between px-5 shadow-sm">
                <div class="flex items-center gap-2 text-primary-600">
                    <i class="fa-solid fa-robot text-xl"></i><span class="font-bold text-lg">KitchenAI</span>
                </div>
                <div class="flex gap-3">
                    <button onclick="app.toggleNotifications()"
                        class="w-9 h-9 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center relative transition active:scale-95">
                        <span id="header-notif"
                            class="absolute top-0 right-0 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-white dark:border-gray-800 hidden animate-pulse"></span>
                        <i class="fa-solid fa-bell text-gray-500"></i>
                    </button>
                    <button onclick="app.toggleTheme()"
                        class="w-9 h-9 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center transition active:scale-95">
                        <i class="fa-solid fa-moon text-gray-500"></i>
                    </button>
                </div>
            </header>

            <div id="notif-panel"
                class="absolute top-16 right-4 w-80 bg-white dark:bg-surface rounded-2xl shadow-2xl border dark:border-gray-700 z-40 hidden transform transition-all origin-top-right animate-fade-in">
                <div
                    class="p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800 rounded-t-2xl">
                    <h3 class="font-bold dark:text-white">Notifications</h3>
                    <button onclick="app.toggleNotifications()" class="text-gray-400 hover:text-red-500"><i
                            class="fa-solid fa-times"></i></button>
                </div>
                <div id="notif-list" class="max-h-64 overflow-y-auto custom-scroll p-2 space-y-1"></div>
            </div>

            <div id="main-view"
                class="flex-1 overflow-y-auto overflow-x-hidden p-4 md:p-8 pb-32 md:pb-10 scroll-smooth custom-scroll w-full">
            </div>

            <!-- REPLACE the existing bottom <nav> block -->
            <!-- DYNAMIC MOBILE NAV CONTAINER -->
            <nav id="bottom-nav"
                class="md:hidden glass fixed bottom-4 left-4 right-4 w-auto h-[70px] border dark:border-gray-700/50 rounded-2xl flex items-center overflow-x-auto no-scrollbar z-30 shadow-[0_8px_32px_0_rgba(0,0,0,0.2)] px-4 justify-between bg-white/80 dark:bg-surface/80 backdrop-blur-xl transition-all duration-300">
                <!-- Injected via renderNav() in script.js -->
            </nav>

        </main>
    </div>

    <div id="quick-menu-modal"
        class="fixed inset-0 z-[140] bg-black/60 backdrop-blur-sm flex items-end justify-center hidden"
        onclick="app.toggleQuickMenu()">
        <!-- REPLACE the content inside <div id="quick-menu-modal" ...> -->
        <div class="bg-white dark:bg-surface rounded-t-3xl shadow-2xl w-full max-w-md mx-auto p-6 animate-slide-up-bottom"
            onclick="event.stopPropagation()">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <h2 class="text-xl font-bold mb-4 dark:text-white text-center">Quick Actions</h2>

            <div class="grid grid-cols-4 gap-2">
                <button onclick="app.nav('inventory'); app.toggleQuickMenu(); app.toggleAddModal();"
                    class="flex flex-col items-center p-2 bg-blue-50 dark:bg-gray-800 rounded-2xl hover:bg-blue-100 transition">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mb-1">
                        <i class="fa-solid fa-box-open"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-white text-center">Add Stock</span>
                </button>

                <button onclick="app.openManualCookModal(); app.toggleQuickMenu();"
                    class="flex flex-col items-center p-2 bg-orange-50 dark:bg-gray-800 rounded-2xl hover:bg-orange-100 transition">
                    <div
                        class="w-10 h-10 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center mb-1">
                        <i class="fa-solid fa-utensils"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-white text-center">Log Meal</span>
                </button>

                <button onclick="app.toggleOCRModal(); app.toggleQuickMenu();"
                    class="flex flex-col items-center p-2 bg-purple-50 dark:bg-gray-800 rounded-2xl hover:bg-purple-100 transition">
                    <div
                        class="w-10 h-10 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mb-1">
                        <i class="fa-solid fa-camera"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-white text-center">Scan Bill</span>
                </button>

                <button onclick="app.nav('chat'); app.toggleQuickMenu();"
                    class="flex flex-col items-center p-2 bg-indigo-50 dark:bg-gray-800 rounded-2xl hover:bg-indigo-100 transition">
                    <div
                        class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-full flex items-center justify-center mb-1 shadow-md">
                        <i class="fa-solid fa-wand-magic-sparkles"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-white text-center">AI Assist</span>
                </button>
            </div>
            <button onclick="app.toggleQuickMenu()"
                class="w-full py-3 mt-6 bg-gray-100 dark:bg-gray-700 rounded-xl font-bold text-sm dark:text-white">Close</button>
        </div>
    </div>

    <!-- MORE MENU MODAL -->
    <div id="more-menu-modal"
        class="fixed inset-0 z-[140] bg-black/60 backdrop-blur-sm flex items-end justify-center hidden"
        onclick="app.toggleMoreMenu()">

        <div class="bg-white dark:bg-surface rounded-t-3xl shadow-2xl w-full max-w-md mx-auto p-6 animate-slide-up-bottom"
            onclick="event.stopPropagation()">
            <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
            <h2 class="text-xl font-bold mb-4 dark:text-white text-center">All Apps</h2>

            <div class="grid grid-cols-4 gap-4 mb-4">
                <button onclick="app.nav('ai'); app.toggleMoreMenu();" class="flex flex-col items-center gap-1 group">
                    <div
                        class="w-14 h-14 bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 rounded-2xl flex items-center justify-center text-xl shadow-sm transition group-hover:scale-105">
                        <i class="fa-solid fa-robot"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-gray-300">AI Chef</span>
                </button>

                <button onclick="app.nav('cook'); app.toggleMoreMenu();" class="flex flex-col items-center gap-1 group">
                    <div
                        class="w-14 h-14 bg-orange-100 dark:bg-orange-900/30 text-orange-600 rounded-2xl flex items-center justify-center text-xl shadow-sm transition group-hover:scale-105">
                        <i class="fa-solid fa-fire"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-gray-300">Cook</span>
                </button>

                <button onclick="app.nav('shopping'); app.toggleMoreMenu();"
                    class="flex flex-col items-center gap-1 group">
                    <div
                        class="w-14 h-14 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-2xl flex items-center justify-center text-xl shadow-sm transition group-hover:scale-105">
                        <i class="fa-solid fa-cart-shopping"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-gray-300">Shop</span>
                </button>

                <button onclick="app.nav('analytics'); app.toggleMoreMenu();"
                    class="flex flex-col items-center gap-1 group">
                    <div
                        class="w-14 h-14 bg-pink-100 dark:bg-pink-900/30 text-pink-600 rounded-2xl flex items-center justify-center text-xl shadow-sm transition group-hover:scale-105">
                        <i class="fa-solid fa-chart-line"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-gray-300">Data</span>
                </button>

                <button onclick="app.nav('settings'); app.toggleMoreMenu();"
                    class="flex flex-col items-center gap-1 group">
                    <div
                        class="w-14 h-14 bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 rounded-2xl flex items-center justify-center text-xl shadow-sm transition group-hover:scale-105">
                        <i class="fa-solid fa-gear"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-gray-300">Settings</span>
                </button>

                <button onclick="app.nav('help'); app.toggleMoreMenu();" class="flex flex-col items-center gap-1 group">
                    <div
                        class="w-14 h-14 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-2xl flex items-center justify-center text-xl shadow-sm transition group-hover:scale-105">
                        <i class="fa-solid fa-circle-question"></i>
                    </div>
                    <span class="text-[10px] font-bold dark:text-gray-300">Help</span>
                </button>
            </div>
            <button onclick="app.toggleMoreMenu()"
                class="w-full py-3 mt-4 bg-gray-100 dark:bg-gray-700 rounded-xl font-bold text-sm dark:text-white">Close</button>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 z-50 hidden bg-black/60 backdrop-blur-sm items-center justify-center p-4"
        onclick="if(event.target===this) app.closeModal()">
        <div
            class="absolute inset-x-0 bottom-0 md:top-1/2 md:left-1/2 md:bottom-auto md:-translate-x-1/2 md:-translate-y-1/2 bg-white dark:bg-surface md:rounded-3xl rounded-t-3xl shadow-2xl w-full md:w-[600px] max-h-[90vh] flex flex-col animate-slide-up">
            <div
                class="p-5 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800 md:rounded-t-3xl rounded-t-3xl shrink-0">
                <h3 id="modal-title" class="font-bold text-xl dark:text-white">Title</h3>
                <button onclick="app.closeModal()"
                    class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center hover:bg-red-100 hover:text-red-500 transition"><i
                        class="fa-solid fa-times"></i></button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto custom-scroll flex-1"></div>
        </div>
    </div>

    <div id="ocr-loader"
        class="fixed inset-0 z-[150] bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center text-white hidden animate-fade-in">
        <div class="loader-spin mb-4"></div>
        <h2 class="text-2xl font-bold mb-2" id="ocr-loader-title">Processing...</h2>
        <p class="text-sm text-gray-400" id="ocr-loader-msg">Analyzing content using AI</p>
    </div>

    <div id="toast"
        class="fixed top-6 right-0 md:right-6 z-[120] w-full md:w-auto px-4 pointer-events-none opacity-0 transition-all duration-300 transform -translate-y-10">
        <div
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border-l-4 border-primary-500 p-4 flex items-center gap-4">
            <div
                class="w-10 h-10 rounded-full bg-primary-100 dark:bg-primary-900/30 flex items-center justify-center text-primary-600 shrink-0">
                <i id="toast-icon" class="fa-solid fa-check-circle"></i>
            </div>
            <div>
                <h4 id="toast-title" class="font-bold text-sm dark:text-white">Success</h4>
                <p id="toast-msg" class="text-xs text-gray-500 dark:text-gray-400">Operation completed.</p>
            </div>
        </div>
    </div>

    <div id="guide-modal"
        class="fixed inset-0 z-[150] bg-black/60 backdrop-blur-sm flex items-center justify-center hidden">
        <div
            class="bg-white dark:bg-surface rounded-3xl shadow-2xl w-full max-w-md mx-4 p-6 max-h-[85vh] overflow-y-auto custom-scroll animate-slide-up text-center">
            <div
                class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center text-primary-600 mx-auto mb-4 text-2xl">
                <i class="fa-solid fa-earth-asia"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2 text-gray-800 dark:text-white" id="guide-modal-title">Welcome!</h2>
            <p class="text-gray-600 dark:text-gray-300 mb-6 text-sm" id="guide-modal-desc">Choose your language to get
                started.</p>
            <div class="space-y-3">
                <button onclick="app.setGuideLang('en');"
                    class="w-full py-3 bg-white border border-gray-200 text-gray-800 rounded-xl font-bold hover:bg-gray-50 transition shadow-sm">English</button>
                <button onclick="app.setGuideLang('si');"
                    class="w-full py-3 bg-primary-600 text-white rounded-xl font-bold hover:bg-primary-700 transition shadow-lg font-sinhala">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω
                    (Sinhala)</button>
            </div>
            <div id="guide-content" class="space-y-4 text-left p-4 mt-6 bg-gray-50 dark:bg-gray-800 rounded-xl hidden">
            </div>
            <div class="p-4 border-t dark:border-gray-700 shrink-0 mt-6 hidden" id="guide-finish-container">
                <button onclick="app.finishGuide()"
                    class="w-full py-3 bg-primary-600 text-white rounded-xl font-bold shadow-lg"
                    id="guide-finish-btn">Get Started / ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</button>
            </div>
        </div>
    </div>

    <div id="family-modal"
        class="fixed inset-0 z-[150] bg-black/60 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="bg-white dark:bg-surface rounded-3xl shadow-2xl w-full max-w-lg mx-4 p-6 animate-slide-up">
            <h2 class="text-2xl font-bold mb-2 text-primary-600" id="family-modal-title"></h2>
            <p class="text-gray-600 dark:text-gray-300 mb-6 text-sm" id="family-modal-desc"></p>
            <div id="family-form-body" class="space-y-4"></div>
        </div>
    </div>

    </div>

    <!-- CHAT WINDOW (Floating AI Assistant) -->
    <div id="chat-window"
        class="fixed bottom-24 right-4 w-[400px] h-[650px] max-h-[75vh] bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl rounded-[2rem] shadow-2xl border border-white/20 dark:border-white/5 z-40 flex flex-col hidden transform transition-all duration-300 translate-y-10 opacity-0 overflow-hidden ring-1 ring-black/5">

        <!-- Header -->
        <div
            class="relative p-5 bg-white/50 dark:bg-black/20 backdrop-blur-md border-b border-white/10 shrink-0 flex items-center justify-between">
            <div class="absolute inset-0 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 pointer-events-none">
            </div>

            <div class="relative flex items-center gap-3 z-10">
                <div class="relative group">
                    <div
                        class="w-11 h-11 bg-gradient-to-tr from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-indigo-500/30 transition transform group-hover:scale-105">
                        <i class="fa-solid fa-wand-magic-sparkles text-lg animate-pulse"></i>
                    </div>
                    <span
                        class="absolute -bottom-1 -right-1 w-3.5 h-3.5 bg-green-500 border-2 border-white dark:border-slate-900 rounded-full"></span>
                </div>
                <div>
                    <h3 class="font-bold text-lg text-slate-800 dark:text-white leading-tight">KitchenAI</h3>
                    <div class="flex items-center gap-1.5 opacity-70">
                        <span
                            class="text-[10px] uppercase font-bold tracking-wider text-indigo-600 dark:text-indigo-400">Assistant</span>
                        <span class="w-1 h-1 bg-slate-400 rounded-full"></span>
                        <span class="text-[10px] text-slate-500 dark:text-slate-400">Online</span>
                        <span class="w-1 h-1 bg-slate-400 rounded-full"></span>
                        <span id="ai-version-display"
                            class="text-[10px] font-mono text-green-600 dark:text-green-400">vDefault</span>
                    </div>
                </div>
            </div>

            <div class="flex gap-1 z-10">
                <button onclick="document.getElementById('ai-update-file').click()"
                    class="w-8 h-8 rounded-full hover:bg-black/5 dark:hover:bg-white/10 flex items-center justify-center transition text-slate-500 dark:text-slate-400"
                    title="Update New Version">
                    <i class="fa-solid fa-cloud-arrow-up"></i>
                </button>
                <input type="file" id="ai-update-file" class="hidden" accept=".json"
                    onchange="app.chat.importKnowledge(this)">

                <button onclick="app.chat.exportKnowledge()"
                    class="w-8 h-8 rounded-full hover:bg-black/5 dark:hover:bg-white/10 flex items-center justify-center transition text-slate-500 dark:text-slate-400"
                    title="Export Questions">
                    <i class="fa-solid fa-cloud-arrow-down"></i>
                </button>

                <button onclick="app.chat.toggle()"
                    class="w-8 h-8 rounded-full hover:bg-black/5 dark:hover:bg-white/10 flex items-center justify-center transition text-slate-500 dark:text-slate-400">
                    <i class="fa-solid fa-compress"></i>
                </button>
            </div>
        </div>

        <!-- Messages Area -->
        <div id="chat-messages" class="flex-1 overflow-y-auto custom-scroll p-5 space-y-5 scroll-smooth">
            <!-- Welcome Message (Auto-injected) -->
        </div>

        <!-- Input Area -->
        <div
            class="p-4 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-t border-white/20 dark:border-white/5 shrink-0">
            <!-- Chips -->
            <div id="chat-chips" class="flex gap-2 overflow-x-auto no-scrollbar mb-4 pb-1">
                <!-- Chips injected by JS -->
            </div>

            <div
                class="relative flex items-center gap-2 bg-gray-100/80 dark:bg-slate-800/80 p-1.5 rounded-[1.5rem] border border-transparent focus-within:border-indigo-500/50 focus-within:ring-4 focus-within:ring-indigo-500/10 transition">

                <button id="chat-mic-btn" onclick="app.chat.startVoice('chat-input')"
                    class="w-10 h-10 rounded-full bg-white dark:bg-slate-700 text-slate-500 dark:text-slate-300 flex items-center justify-center shadow-sm hover:text-red-500 transition shrink-0"
                    title="Voice Input">
                    <i class="fa-solid fa-microphone"></i>
                </button>

                <input id="chat-input" type="text" placeholder="Ask anything..."
                    class="flex-1 bg-transparent border-none outline-none text-slate-800 dark:text-white px-2 placeholder:text-slate-400"
                    onkeypress="if(event.key==='Enter') app.chat.send()">

                <button onclick="app.chat.send()"
                    class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center shadow-md shadow-indigo-600/20 hover:bg-indigo-700 active:scale-95 transition shrink-0">
                    <i class="fa-solid fa-arrow-up"></i>
                </button>
            </div>
            <p class="text-[10px] text-center text-slate-400 mt-2 opacity-60">AI can make mistakes. Check important
                info.</p>
        </div>
    </div>

    <script src="srilanka_budget_data.js"></script>
    <script src="recipes.js"></script>
    <script src="ai_engine.js"></script>
    <script src="grocery_wizard_engine.js"></script>
    <script src="script.js"></script>
</body>

</html>